# Prompt Injection Attack Patterns
# Version: 1.0
# Description: Patterns for detecting prompt injection attacks in LLM input
#
# Pattern Categories:
# - DIRECT_OVERRIDE: Attempts to override/ignore system instructions
# - ROLE_HIJACK: Attempts to change the AI's role/persona
# - DELIMITER_CONFUSION: Using special characters/formats to confuse parsing
# - PROMPT_EXTRACTION: Attempts to extract system prompts
#
# Severity Levels:
# - CRITICAL: Definite attack, immediate block
# - HIGH: Very likely attack, strong indicator
# - MEDIUM: Suspicious, contributes to anomaly score
# - LOW: Weak indicator, minor score contribution

version: "1.0"
description: "Prompt injection attack patterns for input inspection"

categories:
  - id: DIRECT_OVERRIDE
    name: "Direct Instruction Override"
    severity: HIGH
  - id: ROLE_HIJACK
    name: "Role Hijacking"
    severity: HIGH
  - id: DELIMITER_CONFUSION
    name: "Delimiter Confusion"
    severity: MEDIUM
  - id: PROMPT_EXTRACTION
    name: "System Prompt Extraction"
    severity: MEDIUM

patterns:
  # ============================================
  # DIRECT INSTRUCTION OVERRIDE PATTERNS
  # ============================================

  - id: "INJ001"
    category: DIRECT_OVERRIDE
    name: "Ignore Previous Instructions"
    pattern: "ignore\\s+(all\\s+)?(previous|prior|above|earlier|preceding)\\s+(instructions|prompts|rules|guidelines)"
    flags: "i"
    severity: HIGH
    description: "Attempts to make LLM disregard system instructions"

  - id: "INJ002"
    category: DIRECT_OVERRIDE
    name: "Forget Instructions"
    pattern: "forget\\s+(everything|all|your)\\s+(instructions|training|rules|guidelines|programming)"
    flags: "i"
    severity: HIGH
    description: "Attempts to reset LLM context"

  - id: "INJ003"
    category: DIRECT_OVERRIDE
    name: "New Instructions"
    pattern: "new\\s+instructions?:?\\s*[\\n\\r]?"
    flags: "i"
    severity: HIGH
    description: "Attempts to inject new instructions"

  - id: "INJ004"
    category: DIRECT_OVERRIDE
    name: "Disregard Previous"
    pattern: "disregard\\s+(the\\s+)?(previous|prior|above|earlier)"
    flags: "i"
    severity: HIGH
    description: "Attempts to disregard prior context"

  - id: "INJ005"
    category: DIRECT_OVERRIDE
    name: "Override Instructions"
    pattern: "override\\s+(your\\s+)?(instructions|rules|guidelines|programming)"
    flags: "i"
    severity: HIGH
    description: "Direct override command"

  - id: "INJ006"
    category: DIRECT_OVERRIDE
    name: "Stop Being"
    pattern: "stop\\s+being\\s+(a|an|the)?\\s*(assistant|AI|chatbot|helpful)"
    flags: "i"
    severity: HIGH
    description: "Attempts to change assistant behavior"

  - id: "INJ007"
    category: DIRECT_OVERRIDE
    name: "From Now On"
    pattern: "from\\s+now\\s+on,?\\s+(you|ignore|forget|your)"
    flags: "i"
    severity: MEDIUM
    description: "Attempts to establish new behavior"

  # ============================================
  # ROLE HIJACKING PATTERNS
  # ============================================

  - id: "INJ010"
    category: ROLE_HIJACK
    name: "You Are Now"
    pattern: "you\\s+are\\s+(now\\s+)?(a|an|my)?\\s*(new|different|evil|unrestricted|unfiltered)"
    flags: "i"
    severity: HIGH
    description: "Attempts to redefine AI identity"

  - id: "INJ011"
    category: ROLE_HIJACK
    name: "Pretend To Be"
    pattern: "pretend\\s+(to\\s+be|you'?re|that\\s+you\\s+are)"
    flags: "i"
    severity: HIGH
    description: "Role-play instruction to bypass restrictions"

  - id: "INJ012"
    category: ROLE_HIJACK
    name: "Act As"
    pattern: "act\\s+(as|like)\\s+(a|an)?\\s*(if\\s+you\\s+)?"
    flags: "i"
    severity: HIGH
    description: "Character assumption instruction"

  - id: "INJ013"
    category: ROLE_HIJACK
    name: "Roleplay As"
    pattern: "role\\s*-?\\s*play\\s+(as|a)"
    flags: "i"
    severity: HIGH
    description: "Explicit roleplay instruction"

  - id: "INJ014"
    category: ROLE_HIJACK
    name: "Assume Role"
    pattern: "assume\\s+(the\\s+)?(role|identity|persona|character)\\s+(of|as)"
    flags: "i"
    severity: HIGH
    description: "Identity assumption instruction"

  - id: "INJ015"
    category: ROLE_HIJACK
    name: "DAN Mode"
    pattern: "(DAN|do\\s+anything\\s+now)\\s*(mode|enabled|activated)?"
    flags: "i"
    severity: CRITICAL
    description: "Known jailbreak attempt"

  - id: "INJ016"
    category: ROLE_HIJACK
    name: "Developer Mode"
    pattern: "developer\\s+(mode|override)\\s*(enabled|activated|on)?"
    flags: "i"
    severity: CRITICAL
    description: "Known jailbreak attempt"

  - id: "INJ017"
    category: ROLE_HIJACK
    name: "Jailbreak Mode"
    pattern: "(jailbreak|jail\\s*break|unlock)\\s*(mode|activated|enabled)?"
    flags: "i"
    severity: CRITICAL
    description: "Explicit jailbreak attempt"

  # ============================================
  # DELIMITER CONFUSION PATTERNS
  # ============================================

  - id: "INJ020"
    category: DELIMITER_CONFUSION
    name: "JSON Role Injection"
    pattern: "[{\"']\\s*(role|system|assistant|user)\\s*[\"']?\\s*:"
    flags: "i"
    severity: HIGH
    description: "JSON structure attempting to inject roles"

  - id: "INJ021"
    category: DELIMITER_CONFUSION
    name: "XML Tag Injection"
    pattern: "<\\s*(system|assistant|user|prompt|instructions?)\\s*>"
    flags: "i"
    severity: HIGH
    description: "XML-style tag injection"

  - id: "INJ022"
    category: DELIMITER_CONFUSION
    name: "Code Block System"
    pattern: "```\\s*(system|prompt|instructions?)"
    flags: "i"
    severity: MEDIUM
    description: "Code block with system-like content"

  - id: "INJ023"
    category: DELIMITER_CONFUSION
    name: "Llama Format"
    pattern: "(\\[INST\\]|\\[/INST\\]|<<SYS>>|<</SYS>>)"
    flags: "i"
    severity: HIGH
    description: "Llama/Mistral instruction format injection"

  - id: "INJ024"
    category: DELIMITER_CONFUSION
    name: "Role Labels"
    pattern: "^\\s*(Human|Assistant|System|User|AI)\\s*:"
    flags: "im"
    severity: MEDIUM
    description: "Chat role labels at line start"

  - id: "INJ025"
    category: DELIMITER_CONFUSION
    name: "Triple Backtick Escape"
    pattern: "```\\s*(end|exit|escape|stop)\\s*(system|prompt|context)?"
    flags: "i"
    severity: MEDIUM
    description: "Attempts to escape context using code blocks"

  - id: "INJ026"
    category: DELIMITER_CONFUSION
    name: "Separator Injection"
    pattern: "(={3,}|\\-{3,})\\s*(new|system|instructions?)"
    flags: "i"
    severity: MEDIUM
    description: "Using separators to inject new context"

  # ============================================
  # SYSTEM PROMPT EXTRACTION PATTERNS
  # ============================================

  - id: "INJ030"
    category: PROMPT_EXTRACTION
    name: "Repeat Instructions"
    pattern: "repeat\\s+(your\\s+)?(instructions|system\\s+prompt|rules|guidelines)"
    flags: "i"
    severity: MEDIUM
    description: "Attempts to extract system prompt via repetition"

  - id: "INJ031"
    category: PROMPT_EXTRACTION
    name: "What Are Your Instructions"
    pattern: "what\\s+(are|is)\\s+(your|the)\\s+(instructions|rules|guidelines|system\\s+prompt)"
    flags: "i"
    severity: MEDIUM
    description: "Direct query for instructions"

  - id: "INJ032"
    category: PROMPT_EXTRACTION
    name: "Show System Prompt"
    pattern: "show\\s+(me\\s+)?(your\\s+)?(system\\s+prompt|initial\\s+instructions|hidden\\s+prompt)"
    flags: "i"
    severity: MEDIUM
    description: "Request to display system prompt"

  - id: "INJ033"
    category: PROMPT_EXTRACTION
    name: "Print Instructions"
    pattern: "print\\s+(your\\s+)?(system\\s+message|prompt|instructions|rules)"
    flags: "i"
    severity: MEDIUM
    description: "Print command for instructions"

  - id: "INJ034"
    category: PROMPT_EXTRACTION
    name: "Reveal Programming"
    pattern: "reveal\\s+(your\\s+)?(instructions|programming|prompts?|training)"
    flags: "i"
    severity: MEDIUM
    description: "Request to reveal internal programming"

  - id: "INJ035"
    category: PROMPT_EXTRACTION
    name: "Output System Prompt"
    pattern: "output\\s+(the\\s+)?(system\\s+prompt|hidden\\s+instructions|your\\s+rules)"
    flags: "i"
    severity: MEDIUM
    description: "Request to output system prompt"

  - id: "INJ036"
    category: PROMPT_EXTRACTION
    name: "Tell Me Your Prompt"
    pattern: "tell\\s+me\\s+(your\\s+)?(system\\s+prompt|instructions|programming)"
    flags: "i"
    severity: MEDIUM
    description: "Conversational prompt extraction"

  # ============================================
  # ADDITIONAL HIGH-RISK PATTERNS
  # ============================================

  - id: "INJ040"
    category: DIRECT_OVERRIDE
    name: "Bypass Safety"
    pattern: "(bypass|disable|remove|ignore)\\s+(safety|filters?|restrictions?|guardrails?)"
    flags: "i"
    severity: CRITICAL
    description: "Explicit safety bypass attempt"

  - id: "INJ041"
    category: ROLE_HIJACK
    name: "No Restrictions"
    pattern: "(without|no|remove\\s+all)\\s+(restrictions?|limitations?|filters?|safety)"
    flags: "i"
    severity: HIGH
    description: "Requesting unrestricted mode"

  - id: "INJ042"
    category: DIRECT_OVERRIDE
    name: "Admin Override"
    pattern: "(admin|administrator|root|sudo)\\s*(override|access|mode|command)"
    flags: "i"
    severity: HIGH
    description: "Fake admin privilege claim"

  - id: "INJ043"
    category: PROMPT_EXTRACTION
    name: "Decode Base64 Prompt"
    pattern: "(decode|decrypt)\\s+(the\\s+)?(base64|encoded|hidden)\\s+(prompt|instructions)"
    flags: "i"
    severity: MEDIUM
    description: "Attempt to extract encoded prompts"

  - id: "INJ044"
    category: DIRECT_OVERRIDE
    name: "Simulation Request"
    pattern: "(simulate|emulate)\\s+(a\\s+)?(scenario|world|situation)\\s+(where|in\\s+which)\\s+(you|there)"
    flags: "i"
    severity: MEDIUM
    description: "Simulation framing to bypass restrictions"
